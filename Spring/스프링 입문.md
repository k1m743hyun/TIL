# 스프링 입문
  

## 스프링 프로젝트 생성
  

### 사전 준비물
- Java 11
- IDE: IntelliJ or Eclipse
  

### Spring Initializr
- [start.spring.io](https://start.spring.io/)
  - 생성할 프로젝트 설정
    - Project: Gradle Project
    - Language: Java
    - Spring Boot: 2.7.2
    - Project Metadata
      - group: hello
      - Artifact: hello-spring
      - Java: 11
    - Dependencies: Spring Web , Thymeleaf
  - 설정 완료 후 Generate 클릭
  - zip 파일 다운로드 완료 후 압축 해제
  - IntelliJ 실행 후 압축 해제한 디렉토리 열기  

![Spring Initializr](./images/spring-initializr.png)
  

## 스프링 프로젝트 실행
- `src/main/java/hello.hellospring/HelloSpringApplication.java` 파일 열기
- `main` 메서드 실행
- 웹 브라우저에 `http://localhost:8080` 입력
- **Whitelabel Error Page** 에러 페이지가 나타나는 것으로 동작 확인  

![Error Page](./images/error-page.png)
  

## IntelliJ에서 Gradle 대신에 Java로 직접 실행하도록 설정
> 최근 IntelliJ는 로컬에 설치된 Gradle을 통해서 실행하는 것이 기본 설정으로 되어 있다. 이렇게 하면 실행 속도가 느리다.  
아래와 같이 변경하면 Java로 바로 실행해서 실행속도가 더 빠르게 할 수 있다.
- Preferences -> Build, Execution, Deployment -> Build Tools -> Gradle
  - Build and run using: Gradle -> IntelliJ IDEA
  - Run tests using: Gradle -> IntelliJ IDEA  
  
![IntelliJ Preferences](./images/intellij-preferences.png)
  

## 라이브러리 살펴보기
> Gradle은 의존 관계가 있는 라이브러리를 함께 다운로드한다.
  

### Spring Boot Library
- spring-boot-starter-web
  - spring-boot-starter-tomcat: 톰캣 (웹 서버)
  - spring-webmvc: 스프링 웹 MVC
- spring-boot-starter-thymeleaf: 타임리프 템플릿 엔진 (View)
- spring-boot-starter(공통): 스프링 부트 + 스프링 코어 + 로깅
  - spring-boot
    - spring-core
  - spring-boot-starter-logging
    - logback, slf4j
  

### Test Library
- spring-boot-starter-test
  - junit: 테스트 프레임워크
  - mockito: mock 라이브러리
  - assertj: 테스트 코드를 좀 더 편하게 작성하게 도와주는 라이브러리
  - spring-test: 스프링 통합 테스트 지원
  

## View 환경설정
  

### Welcome Page 만들기
- Spring Boot가 제공하는 Welcome Page 기능
  - `static/index.html`을 올려두면 Welcome Page 기능을 제공
  - [Welcome Page: Spring Boot Reference Documentation](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.welcome-page)
  

### thymeleaf 템플릿 엔진
- 동작 확인
  - 웹 브라우저에 `http://localhost:8080/hello` 입력
  - 아래와 같은 페이지가 나오는 것으로 동작 확인  

![hello Page](./images/hello-page.png)
  

- 동작 환경
  - *Controller*에서 Return 값으로 문자를 반환하면 *viewResolver*가 화면을 찾아서 처리
  - 스프링 부트 템플릿 엔진 기본 viewName 매핑
    - `resources:templates/` + **{ViewName}** + `.html`  

![Running Environment](./images/running-env.png)
  
  
- 관련 문서
  - [thymeleaf 공식 사이트](https://www.thymeleaf.org/)
  - [스프링 공식 튜토리얼](https://spring.io/guides/gs/serving-web-content/)
  - [스프링 부트 매뉴얼](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.template-engines)
  

## 빌드하고 실행하기
- `./gradlew build`
- `cd build/libs`
- `java -jar hello-spring-0.0.1-SNAPSHOT.jar`
- 동작 확인
  

## 스프링 웹 개발 기초
  

### 정적 컨텐츠
- 동작 확인
  - `resources/static/hello-static.html` 생성
  - `src/main/java/hello.hellospring/HelloSpringApplication.java`의 `main` 메서드 실행
  - `http://localhost:8080/hello-static.html` 호출 시 아래와 같은 화면 출력  

![hello-static Page](./images/hello-static-page.png)
  

- 동작 환경
  - 먼저 *Controller*가 있는지 확인
  - *Controller*에 없으면 `resources`에 있는지 확인
  - `resources`에 있으면 출력  

![hello-static Running Environment](./images/hello-static-running-env.png)
  

- 관련 문서
  - [스프링 부트 매뉴얼](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.static-content)
  

### MVC와 템플릿 엔진
- 동작 확인
  - `src/main/java/hello.hellospring/controller/HelloController.java`에 `helloMvc` 메서드 추가
  - `resources/template/hello-template.html` 생성
  - `src/main/java/hello.hellospring/HelloSpringApplication.java`의 `main` 메서드 실행
  - `http://localhost:8080/hello-mvc?name=spring` 호출 시 아래와 같은 화면 출력  

![hello-mvc Page](./images/hello-mvc-page.png)
  

- 동작 환경
  - `http://localhost:8080/hello-mvc?name=spring`  

![hello-mvc Running Environment](./images/hello-mvc-running-env.png)
  

### API
- 동작 확인
  - `@ResponseBody` 문자 반환
    - `src/main/java/hello.hellospring/controller/HelloController.java`에 `helloString` 메서드 추가
    - `src/main/java/hello.hellospring/HelloSpringApplication.java`의 `main` 메서드 실행
    - `http://localhost:8080/hello-string?name=spring` 호출 시 아래와 같은 화면 출력  

![hello-string Page](./images/hello-string-page.png)
  

  - `@ResponseBody` 객체 반환
    - `src/main/java/hello.hellospring/controller/HelloController.java`에 `helloApi` 메서드 추가
    - `src/main/java/hello.hellospring/HelloSpringApplication.java`의 `main` 메서드 실행
    - `http://localhost:8080/hello-api?name=spring` 호출 시 아래와 같은 화면 출력  

![hello-api Page](./images/hello-api-page.png)
  
  
- 동작 환경
  - `@ResponseBody`를 사용하면 *viewResolver* 대신에 *HttpMessageConverter*가 동작
    - 문자 처리: *StringHttpMessageConverter*
    - 객체 처리: *MappingJackson2HttpMessageConverter*
    - byte 처리 등 여러가지 *HttpMessageConverter*가 기본적으로 등록  

![@ResponseBody Running Environment](./images/responsebody-running-env.png)
  

## 회원 관리 예제 - 백엔드 개발
  

### 비즈니스 요구사항 정리
- 데이터: 회원ID, 이름
- 기능: 회원 등록, 조회
- 비고: 아직 데이터 저장소가 선정되지 않아 우선 인터페이스로 구현 클래스를 변경할 수 있도록 설계
  - 데이터 저장소는 RDB, NoSQL 등 다양한 저장소를 고민 중인 상황
  - 개발을 진행하기 위해서 초기 개발 단계에서는 구현체로 가벼운 메모리 기반의 데이터 저장소 사용

### 회원 도메인과 리포지토리 만들기
  

#### 회원 객체
- `src/main/java/hello.hellospring/domain/Member.java` 생성
  

#### 회원 리포지토리 인터페이스
- `src/main/java/hello.hellospring/repository/MemberRepository.java` 생성
  

#### 회원 리포지토리 메모리 구현체
- `src/main/java/hello.hellospring/repository/MemoryMemberRepository.java` 생성
  

### 회원 리포지토리 테스트 케이스 작성
- 개발한 기능을 실행해서 테스트할 때 Java의 main 메서드를 통해서 실행하거나, 웹 어플리케이션의 컨트롤러를 통해서 해당 기능을 실행한다.  
  - 이러한 방법은 준비하고 실행하는데 오래 걸리고, 반복 실행하기 어렵고 여러 테스트를 한 번에 실행하기 어렵다는 단점이 있다.  
  - Java는 JUnit이라는 프레임워크로 테스트를 실행해서 이러한 문제를 해결한다.
- 테스트는 각각 독립적으로 실행되어야 한다.  
  - 테스트 순서에 의존 관계가 있는 것은 좋은 테스트가 아니다.
  

#### 회원 리포지토리 메모리 구현체 테스트
- `src/test/java/hello.hellospring/repository/MemoryMemberRepositoryTest.java` 생성
  - 한 번에 여러 테스트를 실행하면 메모리 DB에 직전 테스트의 결과가 남을 수 있다.  
  - 이렇게 되면 다음 이전 테스트 때문에 다음 테스트가 실패할 가능성이 있다.  
  - `@AfterEach`를 사용하면 각 테스트가 종료될 때마다 이 기능을 실행한다.
  - 여기서는 메모리 DB에 저장된 데이터를 삭제한다.
  

### 회원 서비스 개발
- `src/main/java/hello.hellospring/service/MemberService.java` 생성
  

### 회원 서비스 테스트
- `src/test/java/hello.hellospring/service/MemberServiceTest.java` 생성
  - 기존에는 회원 서비스가 메모리 회원 리포지토리를 직접 생성하게 했다.
  - 회원 리포지토리의 코드가 회원 서비스 코드를 DI 가능하게 변경한다.
  - `@BeforeEach`를 사용하면 각 테스트 실행 전에 호출된다.
  - 테스트가 서로 영향이 없도록 항상 새로운 객체를 생성하고, 의존 관계도 새로 맺어준다.
  

# 출처
- [[인프런] 스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술
 (5.0)](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8)
